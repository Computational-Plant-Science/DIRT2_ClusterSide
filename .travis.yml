dist: trusty

services:
  - docker

language: python
python:
  - "3.6"

before_install:
  - docker pull mjstealey/irods-provider-postgres:4.2.3
  - docker run -d -p 127.0.0.1:1247:1247 mjstealey/irods-provider-postgres:4.2.3
  - sudo apt-get install libfuse2
  - sudo apt-get install libfuse2
  - sudo wget https://files.renci.org/pub/irods/releases/4.1.12/ubuntu14/irods-icommands-4.1.12-ubuntu14-x86_64.deb
  - sudo dpkg -i irods-icommands-4.1.12-ubuntu14-x86_64.deb
  - sudo rm irods-icommands-4.1.12-ubuntu14-x86_64.deb
  - sudo chmod +x wait-for-postgres.sh
  - ./wait-for-postgres.sh 127.0.0.1
  - printf '127.0.0.1\n1247\nrods\ntempZone\nrods\n' | iinit

install:
  - pip3 install -e .

script:
  - python3 -m pytest
